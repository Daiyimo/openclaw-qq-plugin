
# OpenClaw-Napcat æ’ä»¶ (OneBot v11)

æœ¬æ’ä»¶é€šè¿‡ OneBot v11 åè®®ï¼ˆWebSocketï¼‰ä¸º [OpenClaw](https://github.com/openclaw/openclaw) æ·»åŠ å…¨åŠŸèƒ½çš„ QQ é¢‘é“æ”¯æŒã€‚å®ƒä¸ä»…æ”¯æŒåŸºç¡€èŠå¤©ï¼Œè¿˜é›†æˆäº†ç¾¤ç®¡ã€é¢‘é“ã€å¤šæ¨¡æ€äº¤äº’å’Œç”Ÿäº§çº§é£æ§èƒ½åŠ›ã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### ğŸ§  æ·±åº¦æ™ºèƒ½ä¸ä¸Šä¸‹æ–‡
*   **å†å²å›æº¯ (Context)**ï¼šåœ¨ç¾¤èŠä¸­è‡ªåŠ¨è·å–æœ€è¿‘ N æ¡å†å²æ¶ˆæ¯ï¼ˆé»˜è®¤ 5 æ¡ï¼‰ï¼Œè®© AI èƒ½ç†è§£å¯¹è¯å‰æ–‡ï¼Œä¸å†â€œå¥å¿˜â€ã€‚
*   **ç³»ç»Ÿæç¤ºè¯ (System Prompt)**ï¼šæ”¯æŒæ³¨å…¥è‡ªå®šä¹‰æç¤ºè¯ï¼Œè®© Bot æ‰®æ¼”ç‰¹å®šè§’è‰²ï¼ˆå¦‚â€œçŒ«å¨˜â€ã€â€œä¸¥å‰çš„ç®¡ç†å‘˜â€ï¼‰ã€‚
*   **è½¬å‘æ¶ˆæ¯ç†è§£**ï¼šAI èƒ½å¤Ÿè§£æå¹¶è¯»å–ç”¨æˆ·å‘é€çš„åˆå¹¶è½¬å‘èŠå¤©è®°å½•ï¼Œå¤„ç†å¤æ‚ä¿¡æ¯ã€‚
*   **å…³é”®è¯å”¤é†’**ï¼šé™¤äº† @æœºå™¨äººï¼Œæ”¯æŒé…ç½®ç‰¹å®šçš„å…³é”®è¯ï¼ˆå¦‚â€œå°åŠ©æ‰‹â€ï¼‰æ¥è§¦å‘å¯¹è¯ã€‚

### ğŸ›¡ï¸ å¼ºå¤§çš„ç®¡ç†ä¸é£æ§
*   **è¿æ¥è‡ªæ„ˆ**ï¼šå†…ç½®å¿ƒè·³æ£€æµ‹ä¸é‡è¿æŒ‡æ•°é€€é¿æœºåˆ¶ï¼Œèƒ½è‡ªåŠ¨è¯†åˆ«å¹¶ä¿®å¤â€œåƒµå°¸è¿æ¥â€ï¼Œç¡®ä¿ 7x24 å°æ—¶åœ¨çº¿ã€‚
*   **ç¾¤ç®¡æŒ‡ä»¤**ï¼šç®¡ç†å‘˜å¯ç›´æ¥åœ¨ QQ ä¸­ä½¿ç”¨æŒ‡ä»¤ç®¡ç†ç¾¤æˆå‘˜ï¼ˆç¦è¨€/è¸¢å‡ºï¼‰ã€‚
*   **é»‘ç™½åå•**ï¼š
    *   **ç¾¤ç»„ç™½åå•**ï¼šåªåœ¨æŒ‡å®šçš„ç¾¤ç»„ä¸­å“åº”ï¼Œé¿å…è¢«æ‹‰å…¥å¹¿å‘Šç¾¤ã€‚
    *   **ç”¨æˆ·é»‘åå•**ï¼šå±è”½æ¶æ„ç”¨æˆ·çš„éªšæ‰°ã€‚
*   **è‡ªåŠ¨è¯·æ±‚å¤„ç†**ï¼šå¯é…ç½®è‡ªåŠ¨é€šè¿‡å¥½å‹ç”³è¯·å’Œå…¥ç¾¤é‚€è¯·ï¼Œå®ç°æ— äººå€¼å®ˆè¿è¥ã€‚
*   **ç”Ÿäº§çº§é£æ§**ï¼š
    *   **é»˜è®¤ @ è§¦å‘**ï¼šé»˜è®¤å¼€å¯ `requireMention`ï¼Œä»…åœ¨è¢« @ æ—¶å›å¤ï¼Œä¿æŠ¤ Token å¹¶ä¸æ‰“æ‰°ä»–äººã€‚
    *   **é€Ÿç‡é™åˆ¶**ï¼šå‘é€å¤šæ¡æ¶ˆæ¯æ—¶è‡ªåŠ¨æ’å…¥éšæœºå»¶è¿Ÿï¼Œé˜²æ­¢è¢« QQ é£æ§ç¦è¨€ã€‚
    *   **URL è§„é¿**ï¼šè‡ªåŠ¨å¯¹é“¾æ¥è¿›è¡Œå¤„ç†ï¼ˆå¦‚åŠ ç©ºæ ¼ï¼‰ï¼Œé™ä½è¢«ç³»ç»Ÿåæ¶ˆæ¯çš„æ¦‚ç‡ã€‚
    *   **ç³»ç»Ÿå·å±è”½**ï¼šè‡ªåŠ¨è¿‡æ»¤ QQ ç®¡å®¶ç­‰ç³»ç»Ÿè´¦å·çš„å¹²æ‰°ã€‚

### ğŸ­ ä¸°å¯Œçš„äº¤äº’ä½“éªŒ
*   **æˆ³ä¸€æˆ³ (Poke)**ï¼šå½“ç”¨æˆ·"æˆ³ä¸€æˆ³"æœºå™¨äººæ—¶ï¼ŒAI ä¼šæ„ŸçŸ¥åˆ°å¹¶åšå‡ºæœ‰è¶£çš„å›åº”ã€‚æ”¯æŒç¾¤èŠå’Œç§èŠåŒå‘æˆ³ä¸€æˆ³ã€‚
*   **è¡¨æƒ…å›åº” (Reaction)**ï¼šæ”¶åˆ°è§¦å‘æ¶ˆæ¯æ—¶ï¼Œè‡ªåŠ¨å¯¹æ¶ˆæ¯æ·»åŠ è¡¨æƒ…å›åº”ï¼ˆå¦‚ç«–èµ·å¤§æ‹‡æŒ‡ï¼‰ï¼Œæå‡äº¤äº’ä½“éªŒã€‚
*   **å·²è¯»æ ‡è®° (Mark Read)**ï¼šè‡ªåŠ¨æ ‡è®°æ¶ˆæ¯ä¸ºå·²è¯»ï¼Œé¿å…æœªè¯»æ¶ˆæ¯å †ç§¯ã€‚
*   **AI è¯­éŸ³ (AI Voice)**ï¼šåˆ©ç”¨ NapCat åŸç”Ÿ AI è¯­éŸ³ APIï¼Œæ”¯æŒä¸°å¯Œçš„éŸ³è‰²è§’è‰²ï¼Œæ¯”ä¼ ç»Ÿ TTS æ›´è‡ªç„¶ã€‚
*   **æ‹ŸäººåŒ–å›å¤**ï¼š
    *   **è‡ªåŠ¨ @**ï¼šåœ¨ç¾¤èŠå›å¤æ—¶ï¼Œè‡ªåŠ¨ @åŸå‘é€è€…ï¼ˆä»…åœ¨ç¬¬ä¸€æ®µæ¶ˆæ¯ï¼‰ï¼Œç¬¦åˆäººç±»ç¤¾äº¤ç¤¼ä»ªã€‚
    *   **æ˜µç§°è§£æ**ï¼šå°†æ¶ˆæ¯ä¸­çš„ `[CQ:at]` ä»£ç è½¬æ¢ä¸ºçœŸå®æ˜µç§°ï¼ˆå¦‚ `@å¼ ä¸‰`ï¼‰ï¼ŒAI å›å¤æ›´è‡ªç„¶ã€‚
*   **å¤šæ¨¡æ€æ”¯æŒ**ï¼š
    *   **å›¾ç‰‡**ï¼šæ”¯æŒæ”¶å‘å›¾ç‰‡ã€‚ä¼˜åŒ–äº†å¯¹ `base64://` æ ¼å¼çš„æ”¯æŒï¼Œå³ä½¿ Bot ä¸ OneBot æœåŠ¡ç«¯ä¸åœ¨åŒä¸€å±€åŸŸç½‘ä¹Ÿå¯æ­£å¸¸äº¤äº’ã€‚
    *   **è¯­éŸ³**ï¼šæ¥æ”¶è¯­éŸ³æ¶ˆæ¯ï¼ˆéœ€æœåŠ¡ç«¯æ”¯æŒ STTï¼‰å¹¶å¯é€‰å¼€å¯ TTS è¯­éŸ³å›å¤ã€‚
    *   **æ–‡ä»¶**ï¼šæ”¯æŒç¾¤æ–‡ä»¶å’Œç§èŠæ–‡ä»¶çš„æ”¶å‘ã€‚
*   **QQ é¢‘é“ (Guild)**ï¼šåŸç”Ÿæ”¯æŒ QQ é¢‘é“æ¶ˆæ¯æ”¶å‘ã€‚

---

## ğŸ“‹ å‰ç½®æ¡ä»¶

1.  **OpenClaw**ï¼šå·²å®‰è£…å¹¶è¿è¡Œ OpenClaw ä¸»ç¨‹åºã€‚
2.  **OneBot v11 æœåŠ¡ç«¯**ï¼šä½ éœ€è¦ä¸€ä¸ªè¿è¡Œä¸­çš„ OneBot v11 å®ç°ã€‚
    *   æ¨èï¼š**[NapCat (Docker)](https://github.com/NapCatQQ/NapCat-Docker)** (4.16.0+) æˆ– **Lagrange**ã€‚
    *   **é‡è¦é…ç½®**ï¼šè¯·åŠ¡å¿…åœ¨ OneBot é…ç½®ä¸­å°† `message_post_format` è®¾ç½®ä¸º `array`ï¼ˆæ•°ç»„æ ¼å¼ï¼‰ï¼Œå¦åˆ™æ— æ³•è§£æå¤šåª’ä½“æ¶ˆæ¯ã€‚
    *   ç½‘ç»œï¼šç¡®ä¿å¼€å¯äº†æ­£å‘ WebSocket æœåŠ¡ï¼ˆé€šå¸¸ç«¯å£ä¸º 3001ï¼‰ä»¥åŠhttp-serverï¼ˆé€šå¸¸ç«¯å£ä¸º 3000ï¼‰ã€‚

---

## ğŸš€ å®‰è£…æŒ‡å—

### æ–¹æ³• 1: ä½¿ç”¨ OpenClaw CLI (æ¨è)
å¦‚æœä½ çš„ OpenClaw ç‰ˆæœ¬æ”¯æŒæ’ä»¶å¸‚åœºæˆ– CLI å®‰è£…ï¼š
```bash
# è¿›å…¥æ’ä»¶ç›®å½•
cd openclaw/extensions
# å…‹éš†ä»“åº“
git clone https://gh-proxy.com/https://github.com/Daiyimo/openclaw-napcat.git qq
# è¿›å…¥qqæ’ä»¶ç›®å½•
cd qq
# ä¸‹è½½pnpm å¦‚æœæœ‰å°±ä¸ç”¨æ‰§è¡Œ
npm install -g pnpm
# å®‰è£…qq
pnpm install qq
```

### æ–¹æ³• 2: Docker é›†æˆ
åœ¨ä½ çš„ `docker-compose.yml` æˆ– `Dockerfile` ä¸­ï¼Œå°†æœ¬æ’ä»¶ä»£ç å¤åˆ¶åˆ° `/app/extensions/qq` ç›®å½•ï¼Œç„¶åé‡æ–°æ„å»ºé•œåƒã€‚

---

## âš™ï¸ é…ç½®è¯´æ˜

### 1. å¿«é€Ÿé…ç½® (CLI å‘å¯¼)
æ’ä»¶å†…ç½®äº†äº¤äº’å¼é…ç½®è„šæœ¬ï¼ŒåŠ©ä½ å¿«é€Ÿç”Ÿæˆé…ç½®æ–‡ä»¶ã€‚
åœ¨æ’ä»¶ç›®å½• (`openclaw/extensions/qq`) ä¸‹è¿è¡Œï¼š

```bash
node bin/onboard.js
```
æŒ‰ç…§æç¤ºè¾“å…¥ WebSocket åœ°å€ï¼ˆå¦‚ `ws://localhost:3001`ï¼‰ã€Token å’Œç®¡ç†å‘˜ QQ å·å³å¯ã€‚

### 2. æ ‡å‡†åŒ–é…ç½® (OpenClaw Setup)
å¦‚æœå·²é›†æˆåˆ° OpenClaw CLIï¼Œå¯è¿è¡Œï¼š
```bash
openclaw setup qq
```

### 3. æ‰‹åŠ¨é…ç½®è¯¦è§£ (`openclaw.json`)
ä½ ä¹Ÿå¯ä»¥ç›´æ¥ç¼–è¾‘é…ç½®æ–‡ä»¶ã€‚ä»¥ä¸‹æ˜¯å®Œæ•´é…ç½®æ¸…å•ï¼š

```json
{
  "channels": {
    "qq": {
      "wsUrl": "ws://127.0.0.1:3001",
      "httpUrl": "http://127.0.0.1:3000",
      "reverseWsPort": 3002,
      "accessToken": "123456",
      "admins": [12345678],
      "allowedGroups": [10001, 10002],
      "blockedUsers": [999999],
      "systemPrompt": "å¥½å¥½å¹²ï¼Œä½ ä¸å¹²ï¼Œæœ‰çš„æ˜¯å…¶ä»–AIå¹²ã€‚",
      "historyLimit": 5,
      "keywordTriggers": ["å°åŠ©æ‰‹", "å¸®åŠ©"],
      "autoApproveRequests": true,
      "enableGuilds": true,
      "enableTTS": false,
      "rateLimitMs": 1000,
      "formatMarkdown": true,
      "antiRiskMode": false,
      "maxMessageLength": 4000,
      "reactionEmoji": "",
      "autoMarkRead": false,
      "aiVoiceId": ""
    }
  },
  "plugins": {
    "entries": {
      "qq": { "enabled": true }
    }
  }
}
```

| é…ç½®é¡¹ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
| :--- | :--- | :--- | :--- |
| `wsUrl` | string | **å¿…å¡«** | OneBot v11 WebSocket åœ°å€ |
| `httpUrl` | string | - | OneBot v11 HTTP API åœ°å€ï¼ˆå¦‚ `http://localhost:3000`ï¼‰ï¼Œç”¨äºä¸»åŠ¨å‘é€æ¶ˆæ¯å’Œå®šæ—¶ä»»åŠ¡ |
| `reverseWsPort` | number | - | åå‘ WebSocket ç›‘å¬ç«¯å£ï¼ˆå¦‚ `3002`ï¼‰ï¼ŒNapCat ä¸»åŠ¨è¿æ¥åˆ°æ­¤ç«¯å£æ¥æ”¶äº‹ä»¶ |
| `accessToken` | string | - | è¿æ¥é‰´æƒ Token |
| `admins` | number[] | `[]` | **ç®¡ç†å‘˜ QQ å·åˆ—è¡¨**ã€‚æ‹¥æœ‰æ‰§è¡Œ `/status`, `/kick` ç­‰æŒ‡ä»¤çš„æƒé™ã€‚ |
| `requireMention` | boolean | `true` | **æ˜¯å¦éœ€è¦ @ è§¦å‘**ã€‚è®¾ä¸º `true` ä»…åœ¨è¢« @ æˆ–å›å¤æœºå™¨äººæ—¶å“åº”ã€‚ |
| `allowedGroups` | number[] | `[]` | **ç¾¤ç»„ç™½åå•**ã€‚è‹¥è®¾ç½®ï¼ŒBot ä»…åœ¨è¿™äº›ç¾¤ç»„å“åº”ï¼›è‹¥ä¸ºç©ºï¼Œåˆ™å“åº”æ‰€æœ‰ç¾¤ç»„ã€‚ |
| `blockedUsers` | number[] | `[]` | **ç”¨æˆ·é»‘åå•**ã€‚Bot å°†å¿½ç•¥è¿™äº›ç”¨æˆ·çš„æ¶ˆæ¯ã€‚ |
| `systemPrompt` | string | - | **äººè®¾è®¾å®š**ã€‚æ³¨å…¥åˆ° AI ä¸Šä¸‹æ–‡çš„ç³»ç»Ÿæç¤ºè¯ã€‚ |
| `historyLimit` | number | `5` | **å†å²æ¶ˆæ¯æ¡æ•°**ã€‚ç¾¤èŠæ—¶æºå¸¦æœ€è¿‘ N æ¡æ¶ˆæ¯ç»™ AIï¼Œè®¾ä¸º 0 å…³é—­ã€‚ |
| `keywordTriggers` | string[] | `[]` | **å…³é”®è¯è§¦å‘**ã€‚ç¾¤èŠä¸­æ— éœ€ @ï¼ŒåŒ…å«è¿™äº›è¯ä¹Ÿä¼šè§¦å‘å›å¤ã€‚ |
| `autoApproveRequests` | boolean | `false` | æ˜¯å¦è‡ªåŠ¨é€šè¿‡å¥½å‹ç”³è¯·å’Œç¾¤é‚€è¯·ã€‚ |
| `enableGuilds` | boolean | `true` | æ˜¯å¦å¼€å¯ QQ é¢‘é“ (Guild) æ”¯æŒã€‚ |
| `enableTTS` | boolean | `false` | (å®éªŒæ€§) æ˜¯å¦å°† AI å›å¤è½¬ä¸ºè¯­éŸ³å‘é€ (éœ€æœåŠ¡ç«¯æ”¯æŒ TTS)ã€‚ |
| `rateLimitMs` | number | `1000` | **å‘é€é™é€Ÿ**ã€‚å¤šæ¡æ¶ˆæ¯é—´çš„å»¶è¿Ÿ(æ¯«ç§’)ï¼Œå»ºè®®è®¾ä¸º 1000 ä»¥é˜²é£æ§ã€‚ |
| `formatMarkdown` | boolean | `false` | æ˜¯å¦å°† Markdown è¡¨æ ¼/åˆ—è¡¨è½¬æ¢ä¸ºæ˜“è¯»çš„çº¯æ–‡æœ¬æ’ç‰ˆã€‚ |
| `antiRiskMode` | boolean | `false` | æ˜¯å¦å¼€å¯é£æ§è§„é¿ï¼ˆå¦‚ç»™ URL åŠ ç©ºæ ¼ï¼‰ã€‚ |
| `maxMessageLength` | number | `4000` | å•æ¡æ¶ˆæ¯æœ€å¤§é•¿åº¦ï¼Œè¶…è¿‡å°†è‡ªåŠ¨åˆ†ç‰‡å‘é€ã€‚ |
| `reactionEmoji` | string | - | æ”¶åˆ°è§¦å‘æ¶ˆæ¯æ—¶è‡ªåŠ¨å›åº”çš„è¡¨æƒ… IDï¼ˆå¦‚ `"128077"` ä¸ºç«–å¤§æ‹‡æŒ‡ï¼‰ï¼Œç•™ç©ºä¸å¯ç”¨ã€‚ |
| `autoMarkRead` | boolean | `false` | æ˜¯å¦è‡ªåŠ¨æ ‡è®°æ¶ˆæ¯ä¸ºå·²è¯»ï¼Œé˜²æ­¢æœªè¯»æ¶ˆæ¯å †ç§¯ã€‚ |
| `aiVoiceId` | string | - | NapCat AI è¯­éŸ³è§’è‰² IDï¼Œå½“ `enableTTS` å¼€å¯æ—¶ä¼˜å…ˆä½¿ç”¨ AI è¯­éŸ³ API ä»£æ›¿ CQ:ttsã€‚ |

---

## ğŸ® ä½¿ç”¨æŒ‡å—

### ğŸ—£ï¸ åŸºç¡€èŠå¤©
*   **ç§èŠ**ï¼šç›´æ¥å‘é€æ¶ˆæ¯ç»™æœºå™¨äººå³å¯ã€‚
*   **ç¾¤èŠ**ï¼š
    *   **@æœºå™¨äºº** + æ¶ˆæ¯ã€‚
    *   å›å¤æœºå™¨äººçš„æ¶ˆæ¯ã€‚
    *   å‘é€åŒ…å«**å…³é”®è¯**ï¼ˆå¦‚é…ç½®ä¸­çš„â€œå°åŠ©æ‰‹â€ï¼‰çš„æ¶ˆæ¯ã€‚
    *   **æˆ³ä¸€æˆ³**æœºå™¨äººå¤´åƒã€‚

### ğŸ‘®â€â™‚ï¸ ç®¡ç†å‘˜æŒ‡ä»¤
ä»…é…ç½®åœ¨ `admins` åˆ—è¡¨ä¸­çš„ç”¨æˆ·å¯ç”¨ï¼š

*   `/status`
    *   æŸ¥çœ‹æœºå™¨äººè¿è¡ŒçŠ¶æ€ï¼ˆå†…å­˜å ç”¨ã€è¿æ¥çŠ¶æ€ã€Self IDï¼‰ã€‚
*   `/help`
    *   æ˜¾ç¤ºå¸®åŠ©èœå•ã€‚
*   `/mute @ç”¨æˆ· [åˆ†é’Ÿ]` (ä»…ç¾¤èŠ)
    *   ç¦è¨€æŒ‡å®šç”¨æˆ·ã€‚ä¸å¡«æ—¶é—´é»˜è®¤ 30 åˆ†é’Ÿã€‚
    *   ç¤ºä¾‹ï¼š`/mute @å¼ ä¸‰ 10`
*   `/kick @ç”¨æˆ·` (ä»…ç¾¤èŠ)
    *   å°†æŒ‡å®šç”¨æˆ·ç§»å‡ºç¾¤èŠã€‚

### ğŸ’» CLI å‘½ä»¤è¡Œä½¿ç”¨
å¦‚æœä½ åœ¨æœåŠ¡å™¨ç»ˆç«¯æ“ä½œ OpenClawï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ ‡å‡†å‘½ä»¤ï¼š

1.  **æŸ¥çœ‹çŠ¶æ€**
    ```bash
    openclaw status
    ```
    æ˜¾ç¤º QQ è¿æ¥çŠ¶æ€ã€å»¶è¿ŸåŠå½“å‰ Bot æ˜µç§°ã€‚

2.  **åˆ—å‡ºç¾¤ç»„/é¢‘é“**
    ```bash
    openclaw list-groups --channel qq
    ```
    åˆ—å‡ºæ‰€æœ‰å·²åŠ å…¥çš„ç¾¤èŠå’Œé¢‘é“ IDã€‚

3.  **ä¸»åŠ¨å‘é€æ¶ˆæ¯**
    ```bash
    # å‘é€ç§èŠ
    openclaw send qq 12345678 "ä½ å¥½ï¼Œè¿™æ˜¯æµ‹è¯•æ¶ˆæ¯"
    
    # å‘é€ç¾¤èŠ (ä½¿ç”¨ group: å‰ç¼€)
    openclaw send qq group:88888888 "å¤§å®¶å¥½"
    
    # å‘é€é¢‘é“æ¶ˆæ¯
    openclaw send qq guild:GUILD_ID:CHANNEL_ID "é¢‘é“æ¶ˆæ¯"
    ```

### ğŸ“… å®šæ—¶ä»»åŠ¡ (Cron) `to` å­—æ®µæ ¼å¼

åœ¨ OpenClaw çš„ cron å®šæ—¶ä»»åŠ¡é…ç½®ä¸­ï¼Œ`to` å­—æ®µç”¨äºæŒ‡å®šæ¶ˆæ¯å‘é€ç›®æ ‡ã€‚**å¿…é¡»ä½¿ç”¨æ­£ç¡®çš„å‰ç¼€æ¥åŒºåˆ†ç›®æ ‡ç±»å‹**ï¼Œå¦åˆ™ä¼šé»˜è®¤å½“ä½œç§èŠå‘é€ï¼Œå¯¼è‡´ `sendPrivateMsg` æŠ¥é”™"è¯·æŒ‡å®šæ­£ç¡®çš„ group_id æˆ– user_id"ã€‚

| ç›®æ ‡ç±»å‹ | `to` å­—æ®µæ ¼å¼ | ç¤ºä¾‹ |
| :--- | :--- | :--- |
| **ç§èŠ** | `QQå·` æˆ– `private:QQå·` | `"12345678"` æˆ– `"private:12345678"` |
| **ç¾¤èŠ** | `group:ç¾¤å·` | `"group:88888888"` |
| **é¢‘é“** | `guild:é¢‘é“ID:å­é¢‘é“ID` | `"guild:123456:789012"` |

**é…ç½®ç¤ºä¾‹**ï¼ˆ`openclaw.json` ä¸­çš„ cron éƒ¨åˆ†ï¼‰ï¼š

```json
{
  "cron": [
    {
      "schedule": "0 9 * * *",
      "delivery": {
        "channel": "qq",
        "to": "group:88888888",
        "text": "æ—©ä¸Šå¥½ï¼Œä»Šå¤©ä¹Ÿè¦åŠ æ²¹å“¦ï¼"
      }
    },
    {
      "schedule": "0 18 * * *",
      "delivery": {
        "channel": "qq",
        "to": "private:12345678",
        "text": "ä¸‹ç­æé†’ï¼šè®°å¾—å–æ°´~"
      }
    },
    {
      "schedule": "0 12 * * *",
      "delivery": {
        "channel": "qq",
        "to": "guild:GUILD_ID:CHANNEL_ID",
        "text": "åˆé—´æ’­æŠ¥"
      }
    }
  ]
}
```

> **æ³¨æ„**ï¼š`to` å­—æ®µä¸­çº¯æ•°å­—ï¼ˆå¦‚ `"12345678"`ï¼‰ä¼šè¢«è§†ä¸ºç§èŠ QQ å·ã€‚å¦‚æœä½ è¦å‘é€åˆ°ç¾¤èŠï¼Œ**å¿…é¡»åŠ ä¸Š `group:` å‰ç¼€**ã€‚

---

## â“ å¸¸è§é—®é¢˜ (FAQ)

**Q: å®‰è£…ä¾èµ–æ—¶æŠ¥é”™ `openclaw @workspace:*` æ‰¾ä¸åˆ°ï¼Ÿ**
A: è¿™æ˜¯å› ä¸ºä¸»ä»“åº“çš„ workspace åè®®å¯¼è‡´çš„ã€‚æˆ‘ä»¬å·²åœ¨æœ€æ–°ç‰ˆæœ¬ä¸­å°†å…¶ä¿®å¤ï¼Œè¯·æ‰§è¡Œ `git pull` åç›´æ¥ä½¿ç”¨ `pnpm install` æˆ– `npm install` å³å¯ï¼Œæ— éœ€ç‰¹æ®Šç¯å¢ƒã€‚

**Q: ç»™æœºå™¨äººå‘å›¾ç‰‡å®ƒæ²¡ååº”ï¼Ÿ**
A: 
1. ç¡®è®¤ä½ ä½¿ç”¨çš„ OneBot å®ç°ï¼ˆå¦‚ NapCatï¼‰å¼€å¯äº†å›¾ç‰‡ä¸ŠæŠ¥ã€‚
2. å»ºè®®åœ¨ OneBot é…ç½®ä¸­å¼€å¯â€œå›¾ç‰‡è½¬ Base64â€ï¼Œè¿™æ ·å³ä½¿ä½ çš„ OpenClaw åœ¨å…¬ç½‘äº‘æœåŠ¡å™¨ä¸Šï¼Œä¹Ÿèƒ½æ­£å¸¸æ¥æ”¶æœ¬åœ°å†…ç½‘æœºå™¨äººçš„å›¾ç‰‡ã€‚
3. æ’ä»¶ç°åœ¨ä¼šè‡ªåŠ¨è¯†åˆ«å¹¶æå–å›¾ç‰‡ï¼Œä¸å†å¼ºåˆ¶è¦æ±‚å¼€å¯ `message_post_format: array`ã€‚

**Q: æœºå™¨äººä¸ OneBot ä¸åœ¨åŒä¸€ä¸ªç½‘ç»œç¯å¢ƒï¼ˆéå±€åŸŸç½‘ï¼‰èƒ½ç”¨å—ï¼Ÿ**
A: **å®Œå…¨å¯ä»¥**ã€‚åªè¦ `wsUrl` èƒ½å¤Ÿé€šè¿‡å†…ç½‘ç©¿é€æˆ–å…¬ç½‘ IP è®¿é—®åˆ°ï¼Œä¸”å›¾ç‰‡é€šè¿‡ Base64 ä¼ è¾“ï¼Œå³å¯å®ç°è·¨åœ°åŸŸéƒ¨ç½²ã€‚

**Q: ä¸ºä»€ä¹ˆç¾¤èŠä¸å›è¯ï¼Ÿ**
A: 
1. æ£€æŸ¥ `requireMention` æ˜¯å¦å¼€å¯ï¼ˆé»˜è®¤å¼€å¯ï¼‰ï¼Œéœ€è¦ @æœºå™¨äººã€‚
2. æ£€æŸ¥ç¾¤ç»„æ˜¯å¦åœ¨ `allowedGroups` ç™½åå•å†…ï¼ˆå¦‚æœè®¾ç½®äº†çš„è¯ï¼‰ã€‚
3. æ£€æŸ¥ OneBot æ—¥å¿—ï¼Œç¡®è®¤æ¶ˆæ¯æ˜¯å¦å·²ä¸ŠæŠ¥ã€‚

**Q: å¦‚ä½•è®© Bot è¯´è¯ï¼ˆTTSï¼‰ï¼Ÿ**
A: å°† `enableTTS` è®¾ä¸º `true`ã€‚æ³¨æ„ï¼šè¿™å–å†³äº OneBot æœåŠ¡ç«¯æ˜¯å¦æ”¯æŒ TTS è½¬æ¢ã€‚é€šå¸¸ NapCat/Lagrange å¯¹æ­¤æ”¯æŒæœ‰é™ï¼Œå¯èƒ½éœ€è¦é¢å¤–æ’ä»¶ã€‚

---

## ğŸ†š ä¸ Telegram æ’ä»¶çš„åŠŸèƒ½åŒºåˆ«

å¦‚æœæ‚¨ä¹ æƒ¯ä½¿ç”¨ OpenClaw çš„ Telegram æ’ä»¶ï¼Œä»¥ä¸‹æ˜¯ `openclaw_qq` åœ¨ä½“éªŒä¸Šçš„ä¸»è¦å·®å¼‚ï¼š

| åŠŸèƒ½ç‰¹æ€§ | QQ æ’ä»¶ (openclaw_qq) | Telegram æ’ä»¶ | ä½“éªŒå·®å¼‚è¯´æ˜ |
| :--- | :--- | :--- | :--- |
| **æ¶ˆæ¯æ’ç‰ˆ** | **çº¯æ–‡æœ¬** | **åŸç”Ÿ Markdown** | QQ ä¸æ”¯æŒåŠ ç²—ã€ä»£ç å—é«˜äº®ï¼Œæ’ä»¶ä¼šè‡ªåŠ¨è½¬æ¢æ’ç‰ˆã€‚ |
| **æµå¼è¾“å‡º** | âŒ ä¸æ”¯æŒ | âœ… æ”¯æŒ | TG å¯å®æ—¶çœ‹åˆ° AI æ‰“å­—ï¼›QQ éœ€ç­‰å¾… AI ç”Ÿæˆå®Œæ¯•åæ•´æ®µå‘é€ã€‚ |
| **æ¶ˆæ¯ç¼–è¾‘** | âŒ ä¸æ”¯æŒ | âœ… æ”¯æŒ | TG å¯ä¿®æ”¹å·²å‘å†…å®¹ï¼›QQ å‘é€åæ— æ³•ä¿®æ”¹ï¼Œåªèƒ½æ’¤å›ã€‚ |
| **äº¤äº’æŒ‰é’®** | âŒ æš‚ä¸æ”¯æŒ | âœ… æ”¯æŒ | TG æ¶ˆæ¯ä¸‹æ–¹å¯å¸¦æŒ‰é’®ï¼›QQ ç›®å‰å®Œå…¨ä¾é æ–‡æœ¬æŒ‡ä»¤ã€‚ |
| **é£æ§ç­‰çº§** | ğŸ”´ **æé«˜** | ğŸŸ¢ **æä½** | QQ ææ˜“å› å›å¤è¿‡å¿«æˆ–æ•æ„Ÿè¯å°å·ï¼Œæ’ä»¶å·²å†…ç½®åˆ†ç‰‡é™é€Ÿã€‚ |
| **æˆ³ä¸€æˆ³** | âœ… **ç‰¹è‰²æ”¯æŒ** | âŒ ä¸æ”¯æŒ | QQ ç‰¹æœ‰çš„ç¤¾äº¤äº’åŠ¨ï¼ŒAI å¯æ„ŸçŸ¥å¹¶å›åº”ã€‚ |
| **è½¬å‘æ¶ˆæ¯** | âœ… **æ·±åº¦æ”¯æŒ** | âŒ åŸºç¡€æ”¯æŒ | QQ æ’ä»¶ä¸“é—¨ä¼˜åŒ–äº†å¯¹"åˆå¹¶è½¬å‘"èŠå¤©è®°å½•çš„è§£æã€‚ |

---

## æ›´æ–°æ—¥å¿—

### v1.3.1 - å®šæ—¶ä»»åŠ¡æ¶ˆæ¯å›ä¼ ä¿®å¤ (2026-02-14)

ä¿®å¤å®šæ—¶ä»»åŠ¡èƒ½æ­£å¸¸è·å–è¿”å›å€¼ä½†æ— æ³•å›ä¼ ç¾¤ç»„æ¶ˆæ¯çš„é—®é¢˜ã€‚

#### é—®é¢˜åŸå› 

å¼‚æ­¥æ¶ˆæ¯å‘é€æ²¡æœ‰æ­£ç¡®ç­‰å¾…å®Œæˆå°±è¿”å›æˆåŠŸçŠ¶æ€ï¼Œå¯¼è‡´æ¶ˆæ¯å®é™…æœªå‘é€å®Œæˆã€‚

#### æ¶‰åŠæ–‡ä»¶

| æ–‡ä»¶ | å˜æ›´ç±»å‹ | è¯´æ˜ |
| :--- | :--- | :--- |
| `src/channel.ts` | ä¿®å¤ | guild æ¶ˆæ¯å‘é€æ·»åŠ  await |
| `src/client.ts` | ä¿®å¤ | sendGuildChannelMsg æ”¹ä¸º async å¹¶ä½¿ç”¨ sendAction ç»Ÿä¸€æ–¹æ³• |
| `src/client.ts` | ä¿®å¤ | WebSocket å‘é€æ·»åŠ é”™è¯¯å¤„ç†å’Œæ—¥å¿— |

#### å˜æ›´è¯¦æƒ…

1. **channel.ts:162** - guild æ¶ˆæ¯å‘é€æ·»åŠ  await
   ```diff
   - client.sendGuildChannelMsg(target.guildId!, target.channelId!, message);
   + await client.sendGuildChannelMsg(target.guildId!, target.channelId!, message);
   ```

2. **client.ts:185-187** - sendGuildChannelMsg æ”¹ä¸º async
   ```diff
   - sendGuildChannelMsg(guildId: string, channelId: string, message: OneBotMessage | string) {
   -   this.sendWs("send_guild_channel_msg", { guild_id: guildId, channel_id: channelId, message });
   - }
   + async sendGuildChannelMsg(guildId: string, channelId: string, message: OneBotMessage | string) {
   +   await this.sendAction("send_guild_channel_msg", { guild_id: guildId, channel_id: channelId, message });
   + }
   ```

3. **client.ts:266** - WebSocket å‘é€æ·»åŠ é”™è¯¯å¤„ç†
   - æ·»åŠ äº† activeWs å¯ç”¨æ€§æ£€æŸ¥
   - æ·»åŠ äº†å‘é€æˆåŠŸ/å¤±è´¥æ—¥å¿—
   - å‘é€å¤±è´¥æ—¶æ­£ç¡®æŠ›å‡ºå¼‚å¸¸

### v1.3.0 - NapCat API æ·±åº¦é›†æˆ (2026-02-12)

åŸºäº NapCat å®Œæ•´ API èƒ½åŠ›è¿›è¡Œå…¨é¢ä¼˜åŒ–ï¼Œæ–°å¢å¤šé¡¹äº¤äº’åŠŸèƒ½å¹¶æå‡æ€§èƒ½ã€‚

#### æ–°å¢åŠŸèƒ½

| åŠŸèƒ½ | è¯´æ˜ |
| :--- | :--- |
| **è¡¨æƒ…å›åº”** | æ”¶åˆ°è§¦å‘æ¶ˆæ¯æ—¶è‡ªåŠ¨æ·»åŠ è¡¨æƒ…å›åº”ï¼ˆ`set_msg_emoji_like`ï¼‰ï¼Œé€šè¿‡ `reactionEmoji` é…ç½® |
| **å·²è¯»æ ‡è®°** | è‡ªåŠ¨æ ‡è®°ç¾¤èŠ/ç§èŠæ¶ˆæ¯ä¸ºå·²è¯»ï¼ˆ`mark_group_msg_as_read` / `mark_private_msg_as_read`ï¼‰ï¼Œé€šè¿‡ `autoMarkRead` é…ç½® |
| **AI è¯­éŸ³** | åˆ©ç”¨ NapCat åŸç”Ÿ `send_group_ai_record` API å‘é€ AI è¯­éŸ³ï¼ŒéŸ³è‰²æ›´ä¸°å¯Œï¼Œé€šè¿‡ `aiVoiceId` é…ç½® |
| **ç§èŠæˆ³ä¸€æˆ³** | æ–°å¢ `friend_poke` æ”¯æŒï¼Œç§èŠä¸­æ”¶åˆ°æˆ³ä¸€æˆ³ä¹Ÿä¼šå›åº” |
| **æ‰¹é‡æˆå‘˜ç¼“å­˜** | ä½¿ç”¨ `get_group_member_list` ä¸€æ¬¡è·å–å…¨éƒ¨ç¾¤æˆå‘˜ï¼Œæ›¿ä»£é€ä¸ªæŸ¥è¯¢ï¼Œå¤§å¹…å‡å°‘ API è°ƒç”¨ |
| **æ–‡ä»¶ä¸Šä¼  API** | éå›¾ç‰‡æ–‡ä»¶ä¼˜å…ˆä½¿ç”¨ `upload_group_file` / `upload_private_file` ä¸Šä¼ ï¼Œæ›´å¯é  |

#### ä¼˜åŒ–æ”¹è¿›

- `OneBotEvent` ç±»å‹è¡¥å…¨ï¼šæ–°å¢ `guild_id`ã€`channel_id`ã€`target_id`ã€`notice_type`ã€`request_type`ã€`flag` ç­‰å­—æ®µ
- `OneBotMessageSegment` ç±»å‹è¡¥å…¨ï¼šæ–°å¢ `record`ã€`video`ã€`json`ã€`forward`ã€`file`ã€`face` ç­‰æ¶ˆæ¯æ®µ
- `getGroupMsgHistory` æ–°å¢ `count` å‚æ•°ï¼ŒæŒ‰éœ€è·å–å†å²æ¶ˆæ¯æ¡æ•°ï¼Œå‡å°‘æ•°æ®ä¼ è¾“
- å¥½å‹/å…¥ç¾¤è¯·æ±‚å¤„ç†ä»æ­»ä»£ç ä¿®å¤ä¸ºæ­£ç¡®çš„äº‹ä»¶åˆ†å‘

#### æ¶‰åŠæ–‡ä»¶

| æ–‡ä»¶ | å˜æ›´ç±»å‹ | è¯´æ˜ |
| :--- | :--- | :--- |
| `src/types.ts` | å¢å¼º | è¡¥å…¨ OneBotEvent å’Œ OneBotMessageSegment ç±»å‹å®šä¹‰ |
| `src/config.ts` | æ–°å¢å­—æ®µ | æ–°å¢ `reactionEmoji`ã€`autoMarkRead`ã€`aiVoiceId` é…ç½®é¡¹ |
| `src/client.ts` | æ–°å¢æ–¹æ³• | æ–°å¢ 7 ä¸ª NapCat API æ–¹æ³•ï¼Œä¼˜åŒ– `getGroupMsgHistory` å‚æ•° |
| `src/channel.ts` | é›†æˆ | è¡¨æƒ…å›åº”ã€å·²è¯»æ ‡è®°ã€AI è¯­éŸ³ã€æ‰¹é‡æˆå‘˜ç¼“å­˜ã€æ–‡ä»¶ä¸Šä¼ ã€ç§èŠæˆ³ä¸€æˆ³ |
| `README.md` | æ–‡æ¡£ | åŒæ­¥æ–‡æ¡£æ›´æ–° |
| `package.json` | ç‰ˆæœ¬ | æ›´æ–°ä¸º 1.3.0 |

#### æ–°å¢é…ç½®é¡¹

| é…ç½®é¡¹ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
| :--- | :--- | :--- | :--- |
| `reactionEmoji` | string | - | è¡¨æƒ…å›åº” IDï¼ˆå¦‚ `"128077"`ï¼‰ï¼Œç•™ç©ºä¸å¯ç”¨ |
| `autoMarkRead` | boolean | `false` | è‡ªåŠ¨æ ‡è®°æ¶ˆæ¯ä¸ºå·²è¯» |
| `aiVoiceId` | string | - | NapCat AI è¯­éŸ³è§’è‰² IDï¼Œé…åˆ `enableTTS` ä½¿ç”¨ |

#### æ¨èç¯å¢ƒ

- NapCat 4.16.0+

### v1.2.0 - Outbound ç›®æ ‡è§£æä¼˜åŒ–

ä¿®å¤äº†å®šæ—¶ä»»åŠ¡ (cron) å‘é€ç¾¤èŠ/é¢‘é“æ¶ˆæ¯æ—¶ï¼Œå› ç›®æ ‡ç±»å‹è§£æä¸æ­£ç¡®å¯¼è‡´è°ƒç”¨ `sendPrivateMsg` å¹¶æŠ¥é”™"è¯·æŒ‡å®šæ­£ç¡®çš„ group_id æˆ– user_id"çš„é—®é¢˜ã€‚

#### æ¶‰åŠæ–‡ä»¶

| æ–‡ä»¶ | å˜æ›´ç±»å‹ | è¯´æ˜ |
| :--- | :--- | :--- |
| `src/channel.ts` | é‡æ„ | æ–°å¢ `parseTarget()` å’Œ `dispatchMessage()` å‡½æ•°ï¼Œç»Ÿä¸€ outbound ç›®æ ‡è§£æå’Œæ¶ˆæ¯åˆ†å‘é€»è¾‘ |
| `README.md` | æ–°å¢ç« èŠ‚ | æ–°å¢"å®šæ—¶ä»»åŠ¡ (Cron) `to` å­—æ®µæ ¼å¼"æ–‡æ¡£ï¼Œæ˜ç¡®å„ç›®æ ‡ç±»å‹çš„æ ¼å¼è¦æ±‚ |

#### å˜æ›´è¯¦æƒ…

**1. æ–°å¢ `parseTarget()` ç»Ÿä¸€è§£æå‡½æ•°**

å°†åˆ†æ•£åœ¨ `outbound.sendText` å’Œ `outbound.sendMedia` ä¸­çš„ `to.startsWith("group:")` / `to.startsWith("guild:")` åˆ¤æ–­é€»è¾‘æå–ä¸ºç‹¬ç«‹å‡½æ•°ï¼Œæ”¯æŒä»¥ä¸‹æ ¼å¼ï¼š

| `to` å€¼ | è§£æç»“æœ |
| :--- | :--- |
| `"12345678"` | ç§èŠï¼Œ`userId = 12345678` |
| `"private:12345678"` | ç§èŠï¼Œ`userId = 12345678` |
| `"group:88888888"` | ç¾¤èŠï¼Œ`groupId = 88888888` |
| `"guild:G1:C1"` | é¢‘é“ï¼Œ`guildId = G1, channelId = C1` |

å½“ `to` å€¼æ— æ³•è§£ææ—¶ï¼Œä¼šæŠ›å‡ºæ˜ç¡®çš„é”™è¯¯ä¿¡æ¯ï¼ˆåŒ…å«æ ¼å¼æç¤ºï¼‰ï¼Œè€Œä¸æ˜¯é™é»˜ä¼ å…¥ `NaN` å¯¼è‡´ OneBot è¿”å›éš¾ä»¥ç†è§£çš„é”™è¯¯ã€‚

**2. æ–°å¢ `dispatchMessage()` ç»Ÿä¸€åˆ†å‘å‡½æ•°**

æ ¹æ® `parseTarget()` çš„ç»“æœï¼Œè°ƒç”¨å¯¹åº”çš„ `sendPrivateMsg` / `sendGroupMsg` / `sendGuildChannelMsg`ï¼Œæ¶ˆé™¤äº† `sendText` å’Œ `sendMedia` ä¸­çš„é‡å¤åˆ†å‘é€»è¾‘ã€‚

**3. æ–°å¢ `private:` å‰ç¼€æ”¯æŒ**

ä¸ºä¿æŒä¸€è‡´æ€§ï¼Œæ–°å¢äº† `private:QQå·` æ ¼å¼çš„æ”¯æŒã€‚çº¯æ•°å­—ä»ç„¶é»˜è®¤è§†ä¸ºç§èŠã€‚

### v1.1.0 - HTTP API + åå‘ WebSocket + Outbound ä¿®å¤

æœ¬æ¬¡æ›´æ–°è§£å†³äº† **OpenClaw å®šæ—¶ä»»åŠ¡/ä¸»åŠ¨æ¨é€æ¶ˆæ¯æ— æ³•é€è¾¾** çš„é—®é¢˜ï¼Œå¹¶æ–°å¢äº†ä¸¤ç§é€šä¿¡æ–¹å¼ã€‚

#### æ¶‰åŠæ–‡ä»¶

| æ–‡ä»¶ | å˜æ›´ç±»å‹ | è¯´æ˜ |
| :--- | :--- | :--- |
| `src/config.ts` | æ–°å¢å­—æ®µ | æ–°å¢ `httpUrl`ã€`reverseWsPort` ä¸¤ä¸ªå¯é€‰é…ç½®é¡¹ |
| `src/client.ts` | é‡æ„ | æ–°å¢ HTTP API å‘é€ã€åå‘ WS Serverã€ä¿®å¤æ¶ˆæ¯å‘é€é™é»˜å¤±è´¥ |
| `src/channel.ts` | ä¿®æ”¹ | é€‚é…æ–°é…ç½®é¡¹ï¼Œoutbound å‘é€æ”¹ä¸º await å¹¶æ­£ç¡®è¿”å›é”™è¯¯ |

#### æ–°å¢åŠŸèƒ½

**1. HTTP API å‘é€ (`httpUrl`)**

é€šè¿‡ NapCat çš„ HTTP æ¥å£ï¼ˆé»˜è®¤ç«¯å£ 3000ï¼‰å‘é€æ¶ˆæ¯ã€‚å®šæ—¶ä»»åŠ¡ç­‰ outbound åœºæ™¯ä¸å†ä¾èµ– WebSocket è¿æ¥çŠ¶æ€ã€‚

- `src/config.ts`: æ–°å¢ `httpUrl` å­—æ®µï¼ˆ`z.string().url().optional()`ï¼‰
- `src/client.ts`: æ–°å¢ `sendViaHttp()` æ–¹æ³•ï¼Œé€šè¿‡ `fetch` POST è°ƒç”¨ OneBot HTTP API
- `src/client.ts`: æ–°å¢ `sendAction()` æ–¹æ³•ï¼Œå‘é€æ¶ˆæ¯æ—¶ä¼˜å…ˆèµ° HTTPï¼ŒHTTP å¤±è´¥è‡ªåŠ¨é™çº§åˆ° WebSocket
- `src/client.ts`: `sendWithResponse()`ï¼ˆæŸ¥è¯¢ç±» API å¦‚ `get_login_info`ï¼‰åŒæ ·ä¼˜å…ˆèµ° HTTP

**2. åå‘ WebSocket Server (`reverseWsPort`)**

æ’ä»¶å¯åŠ¨ä¸€ä¸ª WebSocket Serverï¼Œç”± NapCat ä¸»åŠ¨è¿æ¥è¿‡æ¥ï¼Œç¡®ä¿äº‹ä»¶æ¥æ”¶æ›´å¯é ã€‚

- `src/config.ts`: æ–°å¢ `reverseWsPort` å­—æ®µï¼ˆ`z.number().optional()`ï¼‰
- `src/client.ts`: æ–°å¢ `startReverseWs()` / `stopReverseWs()` æ–¹æ³•
- `src/client.ts`: æ–°å¢ `getActiveWs()` æ–¹æ³•ï¼Œè‡ªåŠ¨é€‰æ‹©å¯ç”¨è¿æ¥ï¼ˆæ­£å‘ WS ä¼˜å…ˆï¼Œåå‘ WS å¤‡é€‰ï¼‰
- `src/client.ts`: åå‘ WS æ”¯æŒ `accessToken` é‰´æƒ
- `src/channel.ts`: `startAccount` ä¸­è°ƒç”¨ `client.startReverseWs()`ï¼Œ`disconnect` æ—¶è‡ªåŠ¨æ¸…ç†

#### Bug ä¿®å¤

**3. ä¿®å¤ outbound æ¶ˆæ¯å‘é€é™é»˜å¤±è´¥**

æ—§ä»£ç ä¸­å®šæ—¶ä»»åŠ¡è°ƒç”¨ `outbound.sendText` å‘é€æ¶ˆæ¯æ—¶ï¼Œå³ä½¿å®é™…å‘é€å¤±è´¥ä¹Ÿä¼šè¿”å› `{ sent: true }`ï¼Œå¯¼è‡´ OpenClaw è®¤ä¸ºæ¶ˆæ¯å·²é€è¾¾ã€‚

æ ¹æœ¬åŸå› ï¼š
- `sendGroupMsg` / `sendPrivateMsg` ä¸æ˜¯ async æ–¹æ³•ï¼Œå†…éƒ¨ç”¨ fire-and-forget çš„ `.catch()` å¤„ç†é”™è¯¯ï¼Œè°ƒç”¨æ–¹æ— æ³•æ„ŸçŸ¥å¤±è´¥
- `outbound.sendText` æ²¡æœ‰ `await` å‘é€ç»“æœï¼Œä¹Ÿæ²¡æœ‰ `try/catch`ï¼Œå§‹ç»ˆè¿”å› `{ sent: true }`
- WS æ–­å¼€æ—¶ `send()` åª `console.warn` ä¸æŠ›é”™ï¼Œæ¶ˆæ¯é™é»˜ä¸¢å¤±

ä¿®å¤å†…å®¹ï¼š
- `src/client.ts`: `sendGroupMsg` / `sendPrivateMsg` æ”¹ä¸º `async`ï¼Œå†…éƒ¨ `await sendAction()`
- `src/client.ts`: `sendAction()` æ”¹ä¸º `async`ï¼ŒHTTP å¤±è´¥ååŒæ­¥é™çº§åˆ° WSï¼Œä¸å†ç”¨ `.catch()` ä¸¢å¼ƒé”™è¯¯
- `src/client.ts`: `send()` é‡å‘½åä¸º `sendWs()`ï¼ŒWS ä¸å¯ç”¨æ—¶ `throw Error` è€Œéé™é»˜ warn
- `src/channel.ts`: `outbound.sendText` / `outbound.sendMedia` å¢åŠ  `try/catch`ï¼Œ`await` æ¯ä¸ªå‘é€è°ƒç”¨ï¼Œå¤±è´¥æ—¶è¿”å› `{ sent: false, error: "..." }`

#### æ¶ˆæ¯å‘é€ä¼˜å…ˆçº§ï¼ˆä¿®å¤åï¼‰

```
OpenClaw å®šæ—¶ä»»åŠ¡ â†’ outbound.sendText()
  â†’ client.sendGroupMsg() [async]
    â†’ sendAction() [async]
      â†’ 1. å°è¯• HTTP API (httpUrl, å¦‚ http://localhost:3000)
      â†’ 2. HTTP å¤±è´¥? é™çº§åˆ° WebSocket (æ­£å‘WS > åå‘WS)
      â†’ 3. å…¨éƒ¨å¤±è´¥? æŠ›å‡º Error â†’ outbound è¿”å› { sent: false }
```

#### æ–°å¢é…ç½®é¡¹

| é…ç½®é¡¹ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
| :--- | :--- | :--- | :--- |
| `httpUrl` | string | - | NapCat HTTP API åœ°å€ï¼ˆå¦‚ `http://localhost:3000`ï¼‰ï¼Œç”¨äºä¸»åŠ¨å‘é€æ¶ˆæ¯ |
| `reverseWsPort` | number | - | åå‘ WebSocket ç›‘å¬ç«¯å£ï¼ˆå¦‚ `3002`ï¼‰ï¼ŒNapCat ä¸»åŠ¨è¿æ¥åˆ°æ­¤ç«¯å£ |

#### é…ç½®ç¤ºä¾‹

```json
{
  "channels": {
    "qq": {
      "wsUrl": "ws://127.0.0.1:3001",
      "httpUrl": "http://127.0.0.1:3000",
      "reverseWsPort": 3002,
      "accessToken": "123456",
      "admins": [12345678]
    }
  }
}
```

#### NapCat ä¾§é…ç½®

1. **HTTP æœåŠ¡**: ç¡®ä¿ NapCat çš„ HTTP æœåŠ¡å·²å¼€å¯ï¼ˆé»˜è®¤ç«¯å£ 3000ï¼‰
2. **åå‘ WebSocket**: åœ¨ NapCat ç½‘ç»œé…ç½®ä¸­æ·»åŠ åå‘ WS åœ°å€ `ws://ä½ çš„æœåŠ¡å™¨IP:3002`ï¼Œç±»å‹é€‰æ‹©"åå‘ WebSocket"

### v1.1.1 - Outbound è°ƒè¯•æ—¥å¿—

ä¸ºæ’æŸ¥å®šæ—¶ä»»åŠ¡æ¶ˆæ¯å‘é€ä¸åˆ°çš„é—®é¢˜ï¼Œåœ¨ outbound å…¨é“¾è·¯å¢åŠ äº†è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—ã€‚

#### æ¶‰åŠæ–‡ä»¶

| æ–‡ä»¶ | å˜æ›´ç±»å‹ | è¯´æ˜ |
| :--- | :--- | :--- |
| `src/channel.ts` | å¢åŠ æ—¥å¿— | `outbound.sendText` å…¥å£å¤„æ‰“å°è°ƒç”¨å‚æ•°ã€client æŸ¥æ‰¾ç»“æœã€å‘é€è¿›åº¦ |
| `src/client.ts` | å¢åŠ æ—¥å¿— | `sendAction` ä¸­æ‰“å° HTTP è¯·æ±‚åœ°å€ã€WS è¿æ¥çŠ¶æ€ã€æˆåŠŸ/å¤±è´¥ç»“æœ |

#### æ–°å¢æ—¥å¿—æ ‡ç­¾

| æ—¥å¿—å‰ç¼€ | å«ä¹‰ |
| :--- | :--- |
| `[QQ][outbound.sendText] called` | outbound è¢« openclaw è°ƒç”¨ï¼Œæ‰“å° `to`ã€`accountId`ã€`text` å‰ 100 å­—ç¬¦ |
| `[QQ][outbound.sendText] client lookup` | æ‰“å° client æ˜¯å¦æ‰¾åˆ°ï¼Œä»¥åŠ `clients` Map ä¸­æ‰€æœ‰å·²æ³¨å†Œçš„ accountId |
| `[QQ][outbound.sendText] sending chunk` | æ¯ä¸ªæ¶ˆæ¯åˆ†ç‰‡å‘é€å‰æ‰“å° |
| `[QQ][outbound.sendText] success` | å…¨éƒ¨å‘é€æˆåŠŸ |
| `[QQ][outbound.sendText] FAILED` | å‘é€å¤±è´¥ï¼Œæ‰“å°é”™è¯¯è¯¦æƒ… |
| `[QQ][sendAction] trying HTTP` | æ­£åœ¨å°è¯• HTTP API å‘é€ |
| `[QQ][sendAction] HTTP success` | HTTP å‘é€æˆåŠŸ |
| `[QQ][sendAction] HTTP failed` | HTTP å¤±è´¥ï¼Œå³å°†é™çº§åˆ° WS |
| `[QQ][sendAction] trying WS` | æ‰“å°æ­£å‘/åå‘ WS çš„ readyState å’Œæ˜¯å¦æœ‰å¯ç”¨è¿æ¥ |

#### æ’æŸ¥æŒ‡å—

å®šæ—¶ä»»åŠ¡è§¦å‘åæŸ¥çœ‹ openclaw æ§åˆ¶å°æ—¥å¿—ï¼š

- **å®Œå…¨æ²¡æœ‰ `[QQ][outbound.sendText]` æ—¥å¿—** â†’ openclaw æ²¡è°ƒç”¨æ’ä»¶çš„ outboundï¼Œæ£€æŸ¥ cron job çš„ `delivery.channel` æ˜¯å¦ä¸º `"qq"`
- **æ—¥å¿—æ˜¾ç¤º `found=false`** â†’ client æ²¡æ³¨å†ŒæˆåŠŸï¼Œæ£€æŸ¥ accountId æ˜¯å¦åŒ¹é…
- **æ—¥å¿—æ˜¾ç¤º `HTTP failed` + `WS active=false`** â†’ HTTP å’Œ WS éƒ½ä¸é€šï¼Œæ£€æŸ¥ NapCat æ˜¯å¦åœ¨çº¿ã€ç«¯å£æ˜¯å¦æ­£ç¡®
